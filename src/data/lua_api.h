#ifndef LUA_API_H
#define LUA_API_H

const char *lua_api_string =
    "function all(t)\n"
    "  if t == nil then\n"
    "    return function() end\n"
    "  end\n"
    "  local ttype = type(t)\n"
    "  if ttype == 'string' then\n"
    "    local i = 0\n"
    "    local tlen = #t\n"
    "    return function()\n"
    "      i = i + 1\n"
    "      if i <= tlen then\n"
    "        return sub(t, i, i)\n"
    "      end\n"
    "    end\n"
    "  else\n"
    "    local i = 0\n"
    "    return function()\n"
    "      i = i + 1\n"
    "      return t[i]\n"
    "    end\n"
    "  end\n"
    "end\n"
    "\n"
    "function add(t, v)\n"
    "  if type(t) == 'table' then\n"
    "    t[#t+1] = v\n"
    "    return v\n"
    "  end\n"
    "end\n"
    "\n"
    "function foreach(c, f)\n"
    "  if c ~= nil then\n"
    "    for value in all(c) do\n"
    "      f(value)\n"
    "    end\n"
    "  end\n"
    "end\n"
    "\n"
    "\n"
    "function mapdraw(...)\n"
    "  map(table.unpack(arg))\n"
    "end\n"
    "\n"
    "function count(t, v)\n"
    "  if type(t) ~= 'table' then\n"
    "    return nil\n"
    "  end\n"
    "  if v == nil then\n"
    "    return #t\n"
    "  end\n"
    "  local c = 0\n"
    "  for i = 1, #t do\n"
    "    if t[i] == v then\n"
    "      c = c + 1\n"
    "    end\n"
    "  end\n"
    "  return c\n"
    "end\n"
    "\n"
    "function del(t, v)\n"
    "  if type(t) == 'table' then\n"
    "    local found = false\n"
    "    for i = 1, #t do\n"
    "      if t[i] == v then\n"
    "        found = true\n"
    "      end\n"
    "      if found then\n"
    "        t[i] = t[i+1]\n"
    "      end\n"
    "    end\n"
    "    if found then\n"
    "      return v\n"
    "    end\n"
    "  end\n"
    "end\n"
    "\n"
    "function deli(t, i)\n"
    "  if type(t) == 'table' then\n"
    "    if i == nil then\n"
    "       i = #t\n"
    "    end\n"
    "    if i < 1 or i > #t then\n"
    "      return nil\n"
    "    end\n"
    "    local v = t[i]\n"
    "    for j = i, #t do\n"
    "      t[j] = t[j+1]\n"
    "    end\n"
    "    return v\n"
    "  end\n"
    "end\n"
    "\n"
    "function cocreate(f)\n"
    "  return coroutine.create(f)\n"
    "end\n"
    "\n"
    "function yield()\n"
    "  coroutine.yield()\n"
    "end\n"
    "\n"
    "-- TODO: missing vararg\n"
    "function coresume(f)\n"
    "  return coroutine.resume(f)\n"
    "end\n"
    "\n"
    "function costatus(f)\n"
    "  return coroutine.status(f)\n"
    "end";

#endif
